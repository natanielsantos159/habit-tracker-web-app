# Habit Tracker Mini App Documentation

## Introduction

Habit Tracker is a simple bot designed to help you develop and maintain positive habits in your daily life.

## Requirements

Minimal requirements for running the app:

- docker
- ngrok
- npm
- localtunnel npm package


## Installation

1. Clone the repository (or download the repository from github as archive) and cd into it:

```bash
git clone git@github.com:natanielsantos159/habit-tracker-web-app.git
cd habit-tracker-web-app
```

2. Install Docker following the instructions [here](https://docs.docker.com/engine/install/) according to your OS.


### Remote setup (optional)

If you want to access the app from outside your local network, you will need to install ngrok and localtunnel npm package.

1. Install ngrok following the instructions [here](https://ngrok.com/download) according to your OS.

2. Install npm following the instructions [here](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm) according to your OS.

3. Install localtunnel npm package:

## Bot Setup Part 1

1. Pick the Telegram server - main or test. [How to access the test server](https://core.telegram.org/bots/webapps#testing-mini-apps).
2. Create a new bot using the [BotFather](https://t.me/botfather) and copy the token, then save it somewhere.

## Front-end Setup

1. Build the front-end docker image:

```bash
cd webapp
docker build -t frontend:latest .
```

2. Run the front-end docker image:

```bash
docker run -d -p 3000:3000 frontend:latest
```
3. Run ngrok:

```bash
ngrok http 3000
```

## Back-end Setup
```bash
1. Copy the .env.example file to .env:

```bash
cd back-end
cp .env.example .env
```

2. Edit the .env file and set the environment variables according to your needs:

```bash
- `BOT_TOKEN` - the token you got from the BotFather
- `WEB_APP_URL` - the host of the web app that you got on step 3. of Front-end Setup - e.g. `https://123456789.ngrok.io`
- `ENV` - either `prod` or `test`
```

3. Build the back-end docker image:

```bash
docker build -t backend:latest .
```

4. Run the back-end docker image:

```bash
docker run -d -p 5000:5000 backend:latest
```
4. Run localtunnel:

```bash
lt --port 5000
```

5. Go to the url provided by it and enter your external IP address following the instructions at the bottom of the page.

6. Copy the url generated on step 4 and run the following command. Replace $LINK with the url generated by localtunnel and $BOT_TOKEN with the token you got from the BotFather:

```bash
curl -X POST -H "Content-Type: application/json" -d '{"url": $LINK}' "https://api.telegram.org/bot$BOT_TOKEN/setWebhook"
```


## Bot Setup Part 2

1. Go to @BotFather and set up the main button
   - Send `/mybots`
   - Select your bot
   - Select `Bot Settings`
   - Select `Menu Button`
   - Configure menu button
   - Enter any name for the button
   - If you're on test server and running the app locally enter http://127.0.0.1:3000 as the menu button link
   - Otherwise, enter your ngrok URL

And your app now should be fully set up and ready for testing!
